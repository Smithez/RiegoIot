<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="AppRiegoIoT.Mobile.MainPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:AppRiegoIoT.Mobile.ViewModels"
             xmlns:models="clr-namespace:AppRiegoIoT.Mobile.Models"
             x:DataType="viewmodels:MainViewModel"
             Title="Sistema de Riego IoT">

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <StackLayout Grid.Row="0" Padding="20" BackgroundColor="#2E8B57">
            <Label Text="🌱 Sistema de Riego IoT" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   TextColor="White" 
                   HorizontalOptions="Center"/>
            <Label Text="{Binding StatusMessage}" 
                   FontSize="12" 
                   TextColor="LightGray"
                   HorizontalOptions="Center"/>
        </StackLayout>
        
        <!-- Content -->
        <ScrollView Grid.Row="1">
            <StackLayout Padding="20" Spacing="20">
                
                <!-- Connection Status -->
                <Frame BackgroundColor="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}" 
                       CornerRadius="10" Padding="15">
                    <Label Text="{Binding IsConnected, Converter={StaticResource BoolToConnectionTextConverter}}"
                           TextColor="White"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>
                </Frame>
                
                <!-- Load Data Button -->
                <Button Text="Cargar Datos" 
                        Command="{Binding LoadDataCommand}"
                        BackgroundColor="#32CD32"
                        TextColor="White"
                        CornerRadius="25"
                        HeightRequest="50"/>
                
                <!-- Fincas Section -->
                <Label Text="📍 Fincas" FontSize="20" FontAttributes="Bold" TextColor="#2E8B57"/>
                <CollectionView ItemsSource="{Binding Fincas}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Finca">
                            <Grid Padding="0,5">
                                <Frame BackgroundColor="White" CornerRadius="10" HasShadow="True">
                                    <Grid RowDefinitions="Auto,Auto,Auto" Padding="15">
                                        <Label Grid.Row="0" Text="{Binding Nombre}" 
                                               FontSize="14" FontAttributes="Bold" TextColor="DarkSlateGray"/>
                                        <Label Grid.Row="1" Text="{Binding Direccion}" 
                                               FontSize="12" TextColor="Gray"/>
                                        <Label Grid.Row="2" Text="{Binding Propietario}" 
                                               FontSize="12" TextColor="DarkBlue"/>
                                    </Grid>
                                </Frame>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <!-- Dispositivos Section -->
                <Label Text="📱 Dispositivos" FontSize="20" FontAttributes="Bold" TextColor="#2E8B57"/>
                <CollectionView ItemsSource="{Binding Dispositivos}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Dispositivo">
                            <Grid Padding="0,5">
                                <Frame BackgroundColor="White" CornerRadius="10" HasShadow="True">
                                    <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto" Padding="15">
                                        <Label Grid.Row="0" Grid.Column="0" Text="{Binding Nombre}" 
                                               FontSize="14" FontAttributes="Bold" TextColor="DarkSlateGray"/>
                                        <Label Grid.Row="1" Grid.Column="0" Text="{Binding Tipo}" 
                                               FontSize="12" TextColor="Gray"/>
                                        <Label Grid.Row="2" Grid.Column="0" Text="{Binding UbicacionDescripcion}" 
                                               FontSize="10" TextColor="LightGray"/>
                                        <Label Grid.Row="0" Grid.RowSpan="3" Grid.Column="1" 
                                               Text="{Binding Estado}" 
                                               FontSize="12" 
                                               TextColor="{Binding Estado, Converter={StaticResource EstadoToColorConverter}}"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Frame>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
            </StackLayout>
        </ScrollView>
        
        <!-- Footer -->
        <StackLayout Grid.Row="2" Padding="10" BackgroundColor="#E8E8E8" Orientation="Horizontal">
            <Label Text="{Binding StatusMessage}" 
                   VerticalOptions="Center" 
                   TextColor="DarkSlateGray"
                   HorizontalOptions="StartAndExpand"/>
            <ActivityIndicator IsRunning="{Binding IsLoading}" 
                             Color="#2E8B57"/>
        </StackLayout>
        
    </Grid>
    
</ContentPage>
